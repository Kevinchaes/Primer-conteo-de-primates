---
title: "Primer conteo de primates Costa Rica"
author: ""
output:
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: scroll
    navbar:
        - { icon: "fab fa-facebook-f", href: "https://www.facebook.com/groups/1089060534898714", align: right }
    source_code: https://github.com/Kevinchaes/Primer-conteo-de-primates.git
---

```{r setup, include=FALSE}

#-------------------- Paquetes --------------------
library(flexdashboard)
library(tidyverse)
library(plotly)
library(dplyr)
library(tidyr)
library(sf)
library(leaflet)
library(leaflet.extras)
#-------------------- Archivos necesarios ---------------------


datos <- "https://raw.githubusercontent.com/Kevinchaes/Primer-conteo-de-primates/master/files/Avistamientos_PrimatesCR.csv"

distritos <- read_sf("C:\\Users\\Kevin\\Documents\\R\\Primer-conteo-de-primates\\SHP\\distritos.shp")

capa <- read_sf("C:\\Users\\Kevin\\Documents\\R\\Primer-conteo-de-primates\\SHP\\Conteo_primates_CR.shp")

dato <- read.csv("~/R/Primer-conteo-de-primates/files/datos.csv")

# Objeto sf de monos en cantones en la última fecha
sf_datos <-
  left_join(distritos, dato, by = c('cod_canton')) %>%
  arrange(desc(Total))

#--------------- Otros parámetros -----------------

ucr <- "https://github.com/Kevinchaes/Primer-conteo-de-primates/blob/master/files/UCR.PNG"
acoprico <- "https://github.com/Kevinchaes/Primer-conteo-de-primates/blob/master/files/ACOPRICO.jpeg"
madeso <- "https://github.com/Kevinchaes/Primer-conteo-de-primates/blob/master/files/firma%20madeso.PNG"
```


```{r, include=FALSE}
#--------------- Archivos de datos ----------------

```

2021
=======================================================================
Column {.sidebar}
-----------------------------------------------------------------------
    
### Desarrollado por:

```{r, out.width = '100%'}
knitr::include_graphics("C:\\Users\\Kevin\\Documents\\R\\Primer-conteo-de-primates\\files\\UCR.PNG")

```

```{r, out.width = '100%'}
knitr::include_graphics("C:\\Users\\Kevin\\Documents\\R\\Primer-conteo-de-primates\\files\\Sede Occidente.PNG")

```

```{r, out.width = '100%'}
knitr::include_graphics("C:\\Users\\Kevin\\Documents\\R\\Primer-conteo-de-primates\\files\\firma madeso.PNG")

```

```{r, out.width = '100%'}
knitr::include_graphics("C:\\Users\\Kevin\\Documents\\R\\Primer-conteo-de-primates\\files\\ACOPRICO.jpeg")

```

Autoria: 

Liz Brenes Cambronero

Ronald Sánchez Porras

Inés Azofeifa Rojas

Michel Moya Calderón

Allan Loria

Kevin Chavarria Esquivel

Row 
-----------------------------------------------------------------------
###  Participantes {.value-box}
```{r}

valueBox(value = 100, 
         caption = "Total de participantes",
         icon = "fas fa-binoculars",
         color = "#3065ab"
)

```

### Registrados {.value-box}
```{r}
valueBox(value = 100, 
         caption = "Total de participantes registrados",
         icon = "fas fa-list",
         color = "#4984d1"
)

```

### Registros {.value-box}
```{r}
valueBox(value = paste(sum(df$Total)), 
         caption = "Total de registros de especies",
         icon = "fas fa-laptop",
         color = "#68a6f7"
)

```

Row {data-height=800}
-----------------------------------------------------------------------
### Distribución espacial de registros
```{r}
leaflet(dato) %>%
  fitBounds(lng1 = -86, lng2 = -82, lat1 = 8, lat2 = 11) %>%
  addProviderTiles(providers$OpenStreetMap.Mapnik, group = "OpenStreetMap") %>%
  addProviderTiles(providers$Stamen.TonerLite, group = "Stamen Toner Lite") %>%
  addProviderTiles(providers$CartoDB.DarkMatter, group = "CartoDB DarkMatter") %>%
  addMarkers(clusterOptions = markerClusterOptions(),
             group = "Registros",
             popup = paste(
               "Especie: ", dato$Especie, "<br>",
               "Nombre común: ", dato$Nombre_com, "<br>",
               "Registros: ", dato$Total, "<br>")) %>%
  addPolygons(
    data = sf_datos,
    stroke=T, fillOpacity = 0,
    color="black", weight=0.2, opacity= 1.0,
    group = "Registros por distritos",
    popup = paste(
      "Provincia: ", sf_datos$provincia.x, "<br>",
      "Cantón: ", sf_datos$canton.x, "<br>",
      "Distrito: ", sf_datos$distrito, "<br>",
      "Especie: ", sf_datos$Especie, "<br>",
      "Nombre común: ", sf_datos$Nombre_com, "<br>",
      "Registros: ", sf_datos$Total, "<br>")) %>%
  addLayersControl(baseGroups = c("OpenStreetMap", "Stamen Toner Lite", "CartoDB DarkMatter"),
                   overlayGroups = c("Registros","Registros por distritos"),
                   options = layersControlOptions(collapsed = TRUE))  %>%
  hideGroup("Registros por distritos") 
```

Row {data-height=600}
-----------------------------------------------------------------------

### Tabla de información 
```{r}
df %>%
  select(Especie = Especie, Nombre_común = Nombre.común, Sitio = Lugar, Registros = Total) %>%
  DT::datatable(rownames = FALSE,
                options = list(searchHighlight = TRUE, 
                               language = list(url = '//cdn.datatables.net/plug-ins/1.10.11/i18n/Spanish.json')
                ))
```

Row {data-height=400}
-----------------------------------------------------------------------

### Mapa cloropletas
```{r}

```

### Gráfico
```{r}

```


Proximamente
=======================================================================
Row {data-height=400}
-----------------------------------------------------------------------
### Conteo de primates 2022

